<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Saturday, July 05, 2008, 4:46 PM -->
<!-- MuClient version 4.31 -->

<!-- Plugin "Aardwolf_Tick_Timer" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Aardwolf_Tick_Timer"
   author="Nick Gammon"
   id="e50b1d08a0cfc0ee9c44947b"
   language="Lua"
   purpose="The time to the next tick is shown on the status bar."
   date_written="2008-07-05 16:46:02"
   requires="4.31"
   version="1.0"
   save_state="y"
   >
</plugin>


<!--  Timers  -->

<timers>
<timer enabled="y" second="1.00" offset_second="0.00"    send_to="12"
>
<send>
   last_tick = last_tick or os.time ()
   last_tick = (last_tick + 30) - os.time() &lt; 0 and os.time() or last_tick
   SetStatus ("Time to tick: " .. (last_tick + 30) - os.time ())
</send>
</timer>
</timers>

<script>
<![CDATA[

function OnPluginTelnetOption (option)
   if option == string.char (101,1) then
      last_tick = os.time()
      SetStatus ("Time to tick: " .. (last_tick + 30) - os.time ())
   end -- if
end -- function

function OnPluginInstall ()
   -- if disabled last time, stay disabled
   if GetVariable ("enabled") == "false" then
      ColourNote ("yellow", "", "Warning: Plugin " .. GetPluginName ().. " is currently disabled.")
      check (EnablePlugin(GetPluginID (), false))
      return
   end -- they didn't enable us last time  
end -- OnPluginInstall

-- pull in telnet option handling
dofile (GetPluginInfo (GetPluginID (), 20) .. "telnet_options.lua")

function OnPluginDisable ()
   OnPluginSaveState()
end -- OnPluginSaveState
  
function OnPluginEnable ()
   OnPluginSaveState()
end

function OnPluginSaveState ()
   SetVariable ("enabled", tostring (GetPluginInfo (GetPluginID (), 17)))
end -- OnPluginSaveState

]]>
</script>
</muclient>
