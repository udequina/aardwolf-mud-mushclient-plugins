<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Monday, May 07, 2018, 10:45 PM -->
<!-- MuClient version 5.06-pre -->

<!-- Plugin "Ready_Check" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Ready_Check"
   author="Castiel"
   id="4538d81dab25fbbb42af0847"
   language="Lua"
   purpose="Announces missing group players"
   save_state="y"
   date_written="2018-05-07 22:45:24"
   requires="5.06"
   version="1.0"
   >
   <description trim="n">
   		<![CDATA[
.----------------------------------------------------------------------------|
|                          Group Ready Check                                 |
|----------------------------------------------------------------------------|
|gcheck -- Announces missing players.                                        |
'----------------------------------------------------------------------------'
]]>
</description>
</plugin>

<aliases>
  <alias regexp="y" match="^gcheck$" enabled="y" script="GroupCheck"></alias>
</aliases>

<include name="constants.lua"/>

<script>
<![CDATA[
	require "gmcphelper"

	function Help()
		ColourNote("orange", "black", GetPluginInfo (GetPluginID (), 3))
	end

	function OnPluginInstall()
		Send_GMCP_Packet("request group")
		Help()
	end

	function GroupCheck(name, line, wildcards)
		local gdata = gmcp("group.members")
		local mplayers = "gt @r:@w:@y:@WGroup Ready Check@y:@w:@r: @W"
		local count = 0

		for u, key in pairs(gdata) do
			if key.info.here == "0" then
				if count == 0 then
					mplayers = mplayers .. key.name
				else
					mplayers = mplayers .. "@C, @W" .. key.name
				end
				count = count + 1
			end
		end
		if count == 0 then
			mplayers = mplayers .. "All players are here and ready!"
		elseif count == 1 then
			mplayers = mplayers .. "@w is not ready."		
		else
			mplayers = string.reverse(mplayers)
			mplayers = string.gsub(mplayers, ",", "dna w@", 1)
			mplayers = string.reverse(mplayers)
			mplayers = mplayers .. "@w are not ready."
		end
		Send(mplayers)
	end
]]>
</script>
</muclient>
