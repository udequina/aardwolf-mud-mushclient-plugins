<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, October 24, 2017, 1:55 PM -->
<!-- MuClient version 4.84 -->

<!-- Plugin "Aarch" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Aarch"
   author="Castiel"
   id="a670f94b1137c568936eacda"
   language="Lua"
   purpose="Keeps tabs on Aarch pieces"
   save_state="y"
   date_written="2017-10-24 13:55:00"
   requires="4.84"
   version="1.0"
   >
   <description trim="n">
   		<![CDATA[
.----------------------------------------------------------------------------.
| Loqui Aarchaeology Tracker Help                                            |
|----------------------------------------------------------------------------|
|lat help -- Brings up the help section. (What you are reading now)          |
|                                                                            |
|lat check              -- Checks (bag if set/inventory) for aarch items.    |
|lat loot               -- Will get an entire pamphlet set from the bag set. |
|lat bag <container ID> -- Sets the bag (Uses ID in identify) to use. Set it |
|                          to 0 to use inventory.                            |
'----------------------------------------------------------------------------'
]]>
</description>
</plugin>

<aliases>
	<alias script="Help" match="^lat help$" enabled="y" regexp="y" sequence="100" ignore_case="y"></alias>
	<alias script="UpdateItems" match="^lat check$" enabled="y" regexp="y" sequence="100" ignore_case="y"></alias>
	<alias script="LootItems" match="^lat loot$" enabled="y" regexp="y" sequence="100" ignore_case="y"></alias>
	<alias script="SetBag" match="^lat bag (.*)$" enabled="y" regexp="y" sequence="100" ignore_case="y"></alias>
</aliases>

<triggers>
	<trigger group="invdata_aarch" regexp="y" match="^{invdata(.*)?}$" enabled="y" sequence="100" omit_from_output="y" script="StartCapture"></trigger>
	<trigger group="invdata_aarch" regexp="y" match="^(?<id>.*),(?<flags>.*),(?<item>.*),(?<lvl>.*),(?<type>.*),(?<unique>.*),(?<wear>.*),(?<timer>.*)$" enabled="n" sequence="100" omit_from_output="y" script="Capture"></trigger>
	<trigger group="invdata_aarch" regexp="y" match="^{/invdata}$" enabled="y" sequence="100" omit_from_output="y" script="StopCapture"></trigger>
</triggers>

<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Script  -->


<script>
<![CDATA[
	local bagID = (GetVariable("bagID") or 0)
	local aarchItemTable = {
		["(Aarchaeology) Johnny's Appleseed"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) An Ancient Skull"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) A Golden Truffle"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) An Ancient Game Token"]	= { count = 0, pCount = 0 },
		["(Aarchaeology) Neptune's Retired Staff"] 	= { count = 0, pCount = 0 },
		["(Aarchaeology) Percival's Retired Crown"] 	= { count = 0, pCount = 0 },
		["(Aarchaeology) Photo of an F1 Tornado"] 	= { count = 0, pCount = 0 },
		["(Aarchaeology) A Ring of Thandeld"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) Petrified Volcano Ash"] 	= { count = 0, pCount = 0 },
		["(Aarchaeology) An Old Coyote's Tooth"] 	= { count = 0, pCount = 0 },
		["(Aarchaeology) Dorothy's Lost Earring"] 	= { count = 0, pCount = 0 },
		["(Aarchaeology) A Golden Cross"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) Skeleton of a Goblin"] 	= { count = 0, pCount = 0 },
		["(Aarchaeology) A Rusted Coin"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) A Rusted Trumpet"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) A Coffin Lid"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) A Wedding Ring"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) A Dinosaur Bone"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) A Dragon's Tooth"]		= { count = 0, pCount = 0 },
		["(Aarchaeology) Unknown Element"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) A Destroyed Mosaic"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) A Silver Cross"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) Lost Binoculars"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) Pirate's Hat"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) A Rusted Cleaver"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) Wilted Rose"] 			= { count = 0, pCount = 0 },
		["(Aarchaeology) Casino Chip"] 			= { count = 0, pCount = 0 },
		["(Aarchaeology) Torn Visitor's Pass"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) Ten-year-old Textbook"]	= { count = 0, pCount = 0 },
		["(Aarchaeology) Ivory Tusks"] 			= { count = 0, pCount = 0 },
		["(Aarchaeology) An Oasis"] 			= { count = 0, pCount = 0 },
		["(Aarchaeology) Skeleton of a Monkey"] 	= { count = 0, pCount = 0 },
		["(Aarchaeology) An Ancient Stalactite"] 	= { count = 0, pCount = 0 },
		["(Aarchaeology) Shoes of a Gnome"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) A Torn Peace Agreement"] 	= { count = 0, pCount = 0 },
		["(Aarchaeology) Chunk of an Iceberg"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) Wings of a Harpy"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) Petrified Tree Branch"] 	= { count = 0, pCount = 0 },
		["(Aarchaeology) A Golden Leaf"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) Writings of a Dream"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) An Old Rope"] 			= { count = 0, pCount = 0 },
		["(Aarchaeology) A Broken Twig"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) Brick from a Castle"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) A Rusted Belt Buckle"] 	= { count = 0, pCount = 0 },
		["(Aarchaeology) A Biblical Textbook"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) Frozen Flames"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) Fox Tooth"] 			= { count = 0, pCount = 0 },
		["(Aarchaeology) Picture of a Forest"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) Moon in a Bottle"] 		= { count = 0, pCount = 0 },
		["(Aarchaeology) Rotting Reed"] 		= { count = 0, pCount = 0 } }

	local aarchPamphletTable = {
		["(Aarchaeology) Collectable Pamphlet #1"] = "(Aarchaeology) Johnny's Appleseed",
		["(Aarchaeology) Collectable Pamphlet #2"] = "(Aarchaeology) An Ancient Skull",
		["(Aarchaeology) Collectable Pamphlet #3"] = "(Aarchaeology) A Golden Truffle",
		["(Aarchaeology) Collectable Pamphlet #4"] = "(Aarchaeology) An Ancient Game Token",
		["(Aarchaeology) Collectable Pamphlet #5"] = "(Aarchaeology) Neptune's Retired Staff",
		["(Aarchaeology) Collectable Pamphlet #6"] = "(Aarchaeology) Percival's Retired Crown",
		["(Aarchaeology) Collectable Pamphlet #7"] = "(Aarchaeology) Photo of an F1 Tornado",
		["(Aarchaeology) Collectable Pamphlet #8"] = "(Aarchaeology) A Ring of Thandeld",
		["(Aarchaeology) Collectable Pamphlet #9"] = "(Aarchaeology) Petrified Volcano Ash",
		["(Aarchaeology) Collectable Pamphlet #10"] = "(Aarchaeology) An Old Coyote's Tooth",
		["(Aarchaeology) Collectable Pamphlet #11"] = "(Aarchaeology) Dorothy's Lost Earring",
		["(Aarchaeology) Collectable Pamphlet #12"] = "(Aarchaeology) A Golden Cross",
		["(Aarchaeology) Collectable Pamphlet #13"] = "(Aarchaeology) Skeleton of a Goblin",
		["(Aarchaeology) Collectable Pamphlet #14"] = "(Aarchaeology) A Rusted Coin",
		["(Aarchaeology) Collectable Pamphlet #15"] = "(Aarchaeology) A Rusted Trumpet",
		["(Aarchaeology) Collectable Pamphlet #16"] = "(Aarchaeology) A Coffin Lid",
		["(Aarchaeology) Collectable Pamphlet #17"] = "(Aarchaeology) A Wedding Ring",
		["(Aarchaeology) Collectable Pamphlet #18"] = "(Aarchaeology) A Dinosaur Bone",
		["(Aarchaeology) Collectable Pamphlet #19"] = "(Aarchaeology) A Dragon's Tooth",
		["(Aarchaeology) Collectable Pamphlet #20"] = "(Aarchaeology) Unknown Element",
		["(Aarchaeology) Collectable Pamphlet #21"] = "(Aarchaeology) A Destroyed Mosaic",
		["(Aarchaeology) Collectable Pamphlet #22"] = "(Aarchaeology) A Silver Cross",
		["(Aarchaeology) Collectable Pamphlet #23"] = "(Aarchaeology) Lost Binoculars",
		["(Aarchaeology) Collectable Pamphlet #24"] = "(Aarchaeology) Pirate's Hat",
		["(Aarchaeology) Collectable Pamphlet #25"] = "(Aarchaeology) A Rusted Cleaver",
		["(Aarchaeology) Collectable Pamphlet #26"] = "(Aarchaeology) Wilted Rose",
		["(Aarchaeology) Collectable Pamphlet #27"] = "(Aarchaeology) Casino Chip",
		["(Aarchaeology) Collectable Pamphlet #28"] = "(Aarchaeology) Torn Visitor's Pass",
		["(Aarchaeology) Collectable Pamphlet #29"] = "(Aarchaeology) Ten-year-old Textbook",
		["(Aarchaeology) Collectable Pamphlet #30"] = "(Aarchaeology) Ivory Tusks",
		["(Aarchaeology) Collectable Pamphlet #31"] = "(Aarchaeology) An Oasis",
		["(Aarchaeology) Collectable Pamphlet #32"] = "(Aarchaeology) Skeleton of a Monkey",
		["(Aarchaeology) Collectable Pamphlet #33"] = "(Aarchaeology) An Ancient Stalactite",
		["(Aarchaeology) Collectable Pamphlet #34"] = "(Aarchaeology) Shoes of a Gnome",
		["(Aarchaeology) Collectable Pamphlet #35"] = "(Aarchaeology) A Torn Peace Agreement",
		["(Aarchaeology) Collectable Pamphlet #36"] = "(Aarchaeology) Chunk of an Iceberg",
		["(Aarchaeology) Collectable Pamphlet #37"] = "(Aarchaeology) Wings of a Harpy",
		["(Aarchaeology) Collectable Pamphlet #38"] = "(Aarchaeology) Petrified Tree Branch",
		["(Aarchaeology) Collectable Pamphlet #39"] = "(Aarchaeology) A Golden Leaf",
		["(Aarchaeology) Collectable Pamphlet #40"] = "(Aarchaeology) Writings of a Dream",
		["(Aarchaeology) Collectable Pamphlet #41"] = "(Aarchaeology) An Old Rope",
		["(Aarchaeology) Collectable Pamphlet #42"] = "(Aarchaeology) A Broken Twig",
		["(Aarchaeology) Collectable Pamphlet #43"] = "(Aarchaeology) Brick from a Castle",
		["(Aarchaeology) Collectable Pamphlet #44"] = "(Aarchaeology) A Rusted Belt Buckle",
		["(Aarchaeology) Collectable Pamphlet #45"] = "(Aarchaeology) A Biblical Textbook",
		["(Aarchaeology) Collectable Pamphlet #46"] = "(Aarchaeology) Frozen Flames",
		["(Aarchaeology) Collectable Pamphlet #47"] = "(Aarchaeology) Fox Tooth",
		["(Aarchaeology) Collectable Pamphlet #48"] = "(Aarchaeology) Picture of a Forest",
		["(Aarchaeology) Collectable Pamphlet #49"] = "(Aarchaeology) Moon in a Bottle",
		["(Aarchaeology) Collectable Pamphlet #50"] = "(Aarchaeology) Rotting Reed" }

	function Help()
		ColourNote("orange", "black", GetPluginInfo (GetPluginID (), 3))
	end
	
	function LootItems(name, line, wildcards)
		local iCount = 0

		if tonumber(bagID) == 0 then
			ColourNote("orange", "", "You do not have a bag set.")
			return
		end

		for key, value in pairs(aarchItemTable) do
			if value.pCount == 0 then
				iCount = iCount + 1
			end
		end
		if iCount == 0 then --No missing pamphlets found
			for i = 1,50 do
				Send("get pamphlet" .. tostring(i) .. " " .. tostring(bagID))
			end
		else
			ColourNote("orange", "", "You do not have a full set of Aarchaelogy pamphlets.")
		end
	end

	function UpdateItems(name, line, wildcards)
		ColourNote("orange", "", "Refreshing item list.")
		if tonumber(bagID) == 0 then
			SendNoEcho("invdata ansi")
		else
			SendNoEcho("invdata " .. bagID .. " ansi")
		end
		EnableTriggerGroup("invdata_aarch", true)
	end

	function StartCapture(name, line, wildcards)
		for key, value in pairs(aarchItemTable) do
			value.count = 0
			value.pCount = 0
		end
	end

	function StopCapture(name, line, wildcards)
		local iCount = 0
		EnableTriggerGroup("invdata_aarch", false)

		ColourNote("orange", "", "You are missing the following:")
		for key, value in pairs(aarchItemTable) do
			if value.count == 0 and value.pCount == 0 then
				ColourNote("cyan", "", " -" .. key)
				iCount = iCount + 1
			end
		end
		if iCount == 0 then
			ColourNote("cyan", "", " -None")
		end
		iCount = 0
		ColourNote("orange", "", "You have the following items to turn in:")
		for key, value in pairs(aarchItemTable) do
			if value.count >= 1 and value.pCount == 0 then
				ColourNote("cyan", "", " -" .. key, "orange", "", " (You do ", "red", "", "NOT", "orange", "", " have this pamphlet)")
				iCount = iCount + 1
			elseif value.count >= 1 and value.pCount >= 1 then
				ColourNote("cyan", "", " -" .. key, "lime", "", " (You already have this pamphlet)")
				iCount = iCount + 1
			end
		end
		if iCount == 0 then
			ColourNote("cyan", "", " -None")
		end
	end

	function Capture(name, line, wildcards, styles)
		local itemName = wildcards.item
		local pCount = 0

		if aarchItemTable[itemName] == nil then
			if aarchPamphletTable[itemName] == nil then --Not an item or pamphlet
				return
			else
				itemName = aarchPamphletTable[itemName]
				pCount = 1

				if aarchItemTable[itemName] == nil then --Not a pamphlet
					return
				end
			end
		end

		if pCount == 0 then --Item
			aarchItemTable[itemName].count = aarchItemTable[itemName].count + 1
		else --Pamphlet
			aarchItemTable[itemName].pCount = aarchItemTable[itemName].pCount + 1
		end
	end

	function SetBag(name, line, wildcards)
		bagID = wildcards[1]
		SetVariable("bagID", bagID)
		ColourNote("orange", "", "Bag ID set to: " .. bagID .. ".")
	end
]]>
</script>


</muclient>