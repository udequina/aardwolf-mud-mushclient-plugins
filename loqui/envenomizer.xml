<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Wednesday, August 15, 2018, 11:41 AM -->
<!-- MuClient version 5.06-pre -->

<!-- Plugin "Envenomizer" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Envenomizer"
   author="Crowley"
   id="c3110d4b535093fcb505ddc8"
   language="Lua"
   purpose="Envenoms all weapons given to you, and returns to proper owners."
   save_state="y"
   date_written="2018-08-15 11:40:15"
   requires="4.00"
   version="1.0"
   >

</plugin>

<!--  Triggers  -->

<triggers>
  <trigger
   group="Envenoms"
   keep_evaluating="y"
   match="^You receive .* from (\w+)\.$"
   name="envon"
   regexp="y"
   script="onGiven"
   sequence="100"
  >
  </trigger>
  <trigger
   group="Envenoms"
   lines_to_match="2"
   keep_evaluating="y"
   name="coating"
   match="You coat .* with deadly poison\.\n\{invitem\}(\d+)\,.*\Z"
   multi_line="y"
   regexp="y"
   script="onCoat"
   sequence="100"
  >
  </trigger>
  <trigger
   group="Envenoms"
   keep_evaluating="y"
   match="^\{invmon\}4\,(\d+)\,\-1\,\-1$"
   name="envmon"
   regexp="y"
   script="giveInvmon"
   sequence="50"
  >
  </trigger>
</triggers>

<!--  Aliases  -->

<aliases>
  <alias
   match="envall"
   enabled="y"
   group="Envenoms"
   script="onEnvall"
   sequence="100"
  >
  </alias>
  <alias
   match="envoff"
   enabled="y"
   group="Envenoms"
   script="onEnvoff"
   sequence="100"
  >
  </alias>
  <alias
   match="envon"
   enabled="y"
   group="Envenoms"
   script="onEnvon"
   sequence="100"
  >
  </alias>
  <alias
  match="showids"
  enabled="y"
  group="Envenoms"
  script="onShow"
  sequence="100"
  >
  </alias>
</aliases>

<script>
<![CDATA[
function onGiven(name, line, wildcards)
    if not weapons then weapons = {} end
    if not weaponslist then weaponslist = {} end

    for i,v in ipairs(ids) do
        if not weapons[v] then
            weapons[v] = {owner = wildcards[1]}
            table.insert(weaponslist, string.sub(v, 3))
            ids[i] = nil
        end
    end
end

function giveInvmon(name, line, wildcards)
    if not ids then ids = {} end
    table.insert(ids, "id" .. wildcards[1])
end

function onEnvall()
    for i,v in ipairs(weaponslist) do
        Execute("envenom " .. v)
    end
end

function onCoat(name, line, wildcards)
    for i,v in ipairs(weaponslist) do
        if v == wildcards[1] then
            table.remove(weaponslist, i)
            break
        end
    end

    Execute(string.format("give %s %s", wildcards[1], weapons["id"..wildcards[1]].owner))
end

function onEnvoff()
    EnableTrigger("envon", false)
    EnableTrigger("envmon", false)
    EnableTrigger("coating", false)
    weapons = nil
    --Send("nogive")
end

function onEnvon()
    weapons = {}
    ids = {}
    weaponslist = {}
    EnableTrigger("envon")
    EnableTrigger("envmon")
    EnableTrigger("coating")
    --Send("nogive")
end

function onShow()
    require 'tprint'

    if type(ids) == "table" then
      tprint(weapons)
      tprint(weaponslist)
    else
      ColourNote("white", "blue", "Nothing to show!")
    end

end
]]>
</script>

</muclient>