<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, October 15, 2019, 7:15 PM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "covetwrapper" generated by Plugin Wizard -->

<muclient>
<plugin
name="krdupes"
author="glade"
id="23d416171797ab5cff0398a9"
language="Lua"
purpose="toss duplicate keys"
save_state="y"
date_written="2019-10-15 19:14:15"
requires="5.07"
version="1.0"
>

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
      enabled="n"
      name="kr_invdata"
      match="^(\d+),.*?,(.*?),.*?$"
      regexp="y"
      send_to="12"
      sequence="100"
      script="buildTable"
      >
    <send></send>
  </trigger>
  <trigger
      enabled="y"
      name="kr_end"
      match="{/keyring}"
      regexp="y"
      send_to="12"
      script="krEnd"
      sequence="100"
      >
    <send>
      EnableTrigger("kr_invdata", false)
    </send>
  </trigger>
</triggers>

<!--  Aliases  -->

<aliases>
  <alias
      enabled="y"
      match="kr clean"
      send_to="12"
      sequence="1"
      keep_evaluating="n"
      >
    <send>
      EnableTrigger("kr_invdata", true)
      Send("keyring data")
    </send>
  </alias>
</aliases>

<!--  Script  -->


<script>
  <![CDATA[
	keepKeys = {}
	tossKeys = {}

	function buildTable(name, line, wildcards)
	   Note(wildcards[2])
	   if(keepKeys[tostring(wildcards[2])] == nil) then
	      keepKeys[tostring(wildcards[2])] = tonumber(wildcards[1])
	   else
	      tossKeys[wildcards[1]] = tostring(wildcards[2])
	   end
	end

	function krEnd()
	   for k,v in pairs(tossKeys) do
	      Send("keyring get " .. k)
	      Send("drop " .. k)
	   end
	   tossKeys = {}
	   keepKeys = {}
	end
  ]]>
</script>
</muclient>
