<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Wednesday, August 01, 2018, 10:47 PM -->
<!-- MuClient version 5.06-pre -->

<!-- Plugin "Notifier" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Notifier"
   author="Crowley"
   id="f99bb4b89cfa8c90ac2d03d5"
   language="Lua"
   purpose="Pushes event notifications to phone"
   save_state="y"
   date_written="2018-08-01 22:46:31"
   requires="5.06"
   version="1.0"
   >

</plugin>

<!--  Script  -->


<script>
<![CDATA[
local triggerLines = {
{name = "regularDouble", match = "^For the next 15 minutes experience is doubled in honor of the new superhero.", message = "Double!", sound = "pushover"},
{name = "blessingDouble", match = "^Double experience for 10 minutes courtesy of .* daily blessing\\.", message = "Blessing Double!", sound = "pushover"},
{name = "hourDouble", match = "^For the next 60 minutes all experience is doubled!!$", message = "Hour of double!", sound = "cashregister"},
}


local triggerSetup = [[
    <triggers>
     <trigger
      match="%s"
      enabled="y"
      regexp="y"
      group="Notifier"
      keep_evaluating="y"
      sequence="100"
      name="%s"
      script="SendPush"
      >
     </trigger>
    </triggers>
]]

for _,v in ipairs(triggerLines) do
    local triggerXML = string.format(triggerSetup, v.match, v.name)
    ImportXML(triggerXML)
end

local sendParam = [['-s --cacert ca-bundle.crt --form-string "token=a3VvAKFAgf4adyKno1cvdQJRPaSP39" --form-string "user=<ENTER USER ID>" --form-string "message=%s" --form-string "sound=%s" https://api.pushover.net/1/messages.json']]


function SendPush(name, line, wildcards)
    local msg, snd = "", ""

    for _,v in ipairs(triggerLines) do
        if name == v.name then
            msg = v.message
            snd = v.sound
            break
        end
    end

    assert (utils.shellexecute('C:/curl/curl.exe', string.format(sendParam, msg, snd), 'c:/curl', 'open', 0))
end
]]>
</script>


</muclient>
